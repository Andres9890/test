name: Decode Base64 Image from File

on:
  workflow_dispatch:
    inputs:
      base64_file:
        description: 'Path to Base64 text file (relative to repo root)'
        required: true
        default: 'base64.txt'

jobs:
  python:
    name: Decode with Python
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Decode Base64 using Python
        run: |
          mkdir output_python
          python3 -c "
          import base64
          data = open('${{ inputs.base64_file }}', 'r').read().strip()
          with open('output_python/image.png', 'wb') as f:
          f.write(base64.b64decode(data))"

      - name: Upload Python Output
        uses: actions/upload-artifact@v4
        with:
          name: decoded-image-python
          path: output_python/

  bash:
    name: Decode with Bash
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Decode Base64 using Bash
        run: |
          mkdir output_bash
          base64 -d "${{ inputs.base64_file }}" > output_bash/image.png
      - name: Upload Bash Output
        uses: actions/upload-artifact@v4
        with:
          name: decoded-image-bash
          path: output_bash/

  powershell:
    name: Decode with PowerShell
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Decode Base64 using PowerShell
        shell: pwsh
        run: |
          New-Item -ItemType Directory -Path output_pwsh | Out-Null
          $data = Get-Content "${{ inputs.base64_file }}" -Raw
          [System.IO.File]::WriteAllBytes("output_pwsh/image.png", [System.Convert]::FromBase64String($data.Trim()))
      - name: Upload PowerShell Output
        uses: actions/upload-artifact@v4
        with:
          name: decoded-image-powershell
          path: output_pwsh/
